<!DOCTYPE html>
<html>

<head>
    <title>ðŸ’¬ Instant Chat App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- material icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding-bottom: 5rem;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #0d1418;
        }

        .messageContainer {
            width: 75%;
            display: flex;
            flex-direction: column;
        }

        .message {
            border-radius: 4px;
            padding: 0.5rem 1rem;
            width: auto;
            color: #d4d5d7;
            margin-top: 2rem;
        }

        .metaData {
            font-family: monospace;
            font-size: 0.8rem;
            width: auto;
            color: #f1f1f2a1;
        }
        
        .time{
            font-family: monospace;
            font-size: 0.8rem;
            float: right;
            position: relative;
            bottom: -7px;
            color: #f1f1f2a1;
        }

        .receivedMessage {
            background-color: #262d31;
            max-width: 50%;
            width: auto;
            align-self: flex-start;
        }

        .sentMessage {
            max-width: 40%;
            background-color: #056162;
            align-self: flex-end;
        }

        .botMessage {
            max-width: 75%;
            align-self: center;
            background-color: #223138;
            padding: 0.2rem 0.5rem;
            font-size: 0.75rem;
        }

        #form {
            background-color: #1e2428;
            padding: 0.25rem;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            flex-direction: row;
            height: 4rem;
            box-sizing: border-box;
            width: 100%;
            margin: 0 auto;
            justify-content: center;
            align-items: center;
        }

        .nickBox {
            color: #d4d5d7;
            border: 0;
            border-radius: 4px;
            background-color: #33383b;
            height: 75%;
            padding-left: 1.5%;
            padding-right: 1.5%;
            margin-right: 1rem;
            width: 15%;
        }

        .nickBox:focus {
            outline: 0;
            border: 1px #056162 solid;
        }

        .messageBox {
            width: 60%;
            color: #d4d5d7;
            border: 0;
            border-radius: 1000px;
            background-color: #33383b;
            max-width: 60%;
            height: 75%;
            padding-left: 1.5%;
            padding-right: 1.5%;
        }

        .messageBox:focus {
            outline: 0;
            border: 1px #056162 solid;
        }

        .sendButton {
            color: #d4d5d7;
            height: 75%;
            width: auto;
            border-radius: 50%;
            border: 0;
            border-radius: 4px;
            max-width: 10%;
            background-color: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            padding-left: 1rem;
        }
    </style>
</head>

<body>
    <!-- message, receivedMessage, sentMessage, botMessage -->
    <div class="messageContainer container"></div>
    <form id="form" action="">
        <input class="nickBox" placeholder="Nickname">
        <input id="input" autocomplete="off" class="messageBox" placeholder="Type a message...">
        <button class="sendButton">
            <span class="material-icons">
                send
            </span>
        </button>
    </form>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();
        var form = document.getElementById('form');
        var input = document.getElementById('input');
        var nick = document.querySelector(".nickBox");

        // listening for bot messages
        socket.on("botMessage", function (message) {
            console.log(message);
            //dom manipulation for bot messages
            const div = document.createElement("div");
            div.classList.add("message");
            div.classList.add("botMessage");
            div.innerHTML = message;
            document.querySelector(".messageContainer").appendChild(div);
            div.scrollIntoView();
        })

        //emitting new messages if submitted
        form.addEventListener('submit', function (event) {
            event.preventDefault();
            if (input.value) {
                var message = input.value;
                //emitting message and nick to the server
                socket.emit("sentMessage", message);
                socket.emit("nick", nick.value);
                input.value = '';
                //dom manipulation for sent messages
                const div = document.createElement("div");
                div.classList.add("message");
                div.classList.add("sentMessage");
                div.innerHTML = message + "<br><span class = 'metaData'>" + nick.value + "</span>";
                document.querySelector(".messageContainer").appendChild(div);
                div.scrollIntoView();
                //time manipulation
                var d = new Date();
                if(d.getHours() > 12){
                    div.innerHTML = div.innerHTML + "<div class='time'>" + (d.getHours()-12) + ":" + d.getMinutes() + " PM" + "</div>";
                }
                else{
                    div.innerHTML = div.innerHTML + "<div class='time'>" + d.getHours() + ":" + d.getMinutes() + " AM" + "</div>";
                }
            }
            document.querySelector(".nickBox").setAttribute("disabled", "disabled");
            console.log(nick.value);
        });

        //listening for incoming messages
        socket.on("receivedMessage", function (message) {
            // console.log(message);
            //dom manipulation for received messages
            const div = document.createElement("div");
            div.classList.add("message");
            div.classList.add("receivedMessage");
            div.innerHTML = message;
            document.querySelector(".messageContainer").appendChild(div);
            div.scrollIntoView();
        })

        // listening for incoming nicks
        socket.on("nick", function (message) {
            console.log(message);
            var length = document.querySelectorAll(".receivedMessage").length;
            var lastChild = document.querySelectorAll(".receivedMessage")[length - 1];
            lastChild.innerHTML = lastChild.innerHTML + "<br><span class = 'metaData'>" + message + "</span>";
        })
    </script>
</body>

</html>